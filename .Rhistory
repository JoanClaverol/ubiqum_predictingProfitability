colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
coord_flip() +
scale_y_continuous(limits = c(-5000,27000), labels = NULL)+
labs(title = "Total Profits vs Total Volume") +
theme(legend.position = "bottom",
legend.title = element_blank(),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
axis.title.y=element_blank()) + theme_minimal() -> p1
# Is the volume related to the categories?
ExProd %>%
group_by(ProductType) %>%
summarise(Total_Volume = sum(Volume)) %>%
arrange(desc(Total_Volume)) -> Volume_category
# Number of products by category
ExProd %>%
group_by(ProductType) %>%
summarise(Number_Products = n()) %>%
arrange(desc(Number_Products)) -> NumProd_category
# Profit per category
ExProd %>%
group_by(ProductType) %>%
summarise(Mean_Profit_Perc = round(mean(ProfitMargin),2)) %>%
arrange(desc(Mean_Profit_Perc)) -> Profit_category
# # Show the information into one table
# kable(Profit_category %>%
#         left_join(NumProd_category, by = 'ProductType') %>%
#         left_join(Volume_category, by = 'ProductType') %>%
#         mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
#         arrange(desc(Total_Profits)) %>%
#         mutate(Total_Profits = paste0(Total_Profits, " €")),
#       col.names = c("", "Profit", "Nº products",
#                     "Total Volume", "Total Profits")) %>%
#   kable_styling(bootstrap_options = "responsive", font_size = 14) %>%
#   column_spec(1, bold = T, include_thead = T) %>%
#   column_spec(5, background = "#f0f5f0")
# Create a graph to understand
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = paste0(round(Total_Profits, 0)),"€"),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
coord_flip() +
scale_y_continuous(limits = c(-5000,27000), labels = NULL)+
labs(title = "Total Profits vs Total Volume") +
theme(legend.position = "bottom",
legend.title = element_blank(),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
axis.title.y=element_blank()) + theme_minimal() -> p1
p1 + theme(axis.title.x = element_blank(),
axis.title.y = element_blank())
# Create a graph to understand
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = paste(round(Total_Profits, 0)),"€"),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
coord_flip() +
scale_y_continuous(limits = c(-5000,27000), labels = NULL)+
labs(title = "Total Profits vs Total Volume") +
theme(legend.position = "bottom",
legend.title = element_blank(),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
axis.title.y=element_blank()) + theme_minimal() -> p1
# Create a graph to understand
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = paste(round(Total_Profits, 0)),"€"),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
coord_flip() +
scale_y_continuous(limits = c(-5000,27000), labels = NULL)+
labs(title = "Total Profits vs Total Volume") +
theme(legend.position = "bottom",
legend.title = element_blank(),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
axis.title.y=element_blank()) + theme_minimal() -> p1
p1 + theme(axis.title.x = element_blank(),
axis.title.y = element_blank())
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = paste0(round(Total_Profits, 0))),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
coord_flip()
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = paste0(round(Total_Profits, 0)),"€"),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
coord_flip()
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = paste0(round(Total_Profits, 0)),"€"),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3)
# Create a graph to understand
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = round(-Total_Profits, 0)),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
coord_flip()
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = round(paste0(Total_Profits, "€"), 0)),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
coord_flip()
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
coord_flip() +
scale_y_continuous(limits = c(-5000,27000), labels = NULL) +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = paste0(round((Total_Profits), 0)),"€"),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3)
# Create a graph to understand
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
coord_flip() +
scale_y_continuous(limits = c(-5000,27000), labels = NULL) +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = round((Total_Profits), 0)),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
labs(title = "Total Profits vs Total Volume") +
theme(legend.position = "bottom",
legend.title = element_blank(),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
axis.title.y=element_blank()) + theme_minimal() -> p1
p1 + theme(axis.title.x = element_blank(),
axis.title.y = element_blank())
knitr::opts_chunk$set(echo = FALSE)
# looking for NAs
kable(ExProd[is.na(ExProd$BestSellersRank),]) %>%
kable_styling(bootstrap_options = "responsive", font_size = 13) %>%
scroll_box(width = "100%", height = "500px")
knitr::opts_chunk$set(echo = FALSE)
if(require("pacman")=="FALSE"){
install.packages("pacman")
}
pacman::p_load(corrplot, tidyverse, caret, dunn.test, Hmisc,xtable, htmlTable,
partykit, knitr, kableExtra, dummies, RColorBrewer, e1071, gbm)
ExProd <- read_csv("../data/existingproductattributes2017.2.csv")
NwProd <- read_csv("../data/newproductattributes2017.2.csv")
fact_var <- c("ProductType","ProductNum")
ExProd[fact_var] <- apply(ExProd[fact_var], 2, as.factor)
# looking for NAs
kable(ExProd[is.na(ExProd$BestSellersRank),]) %>%
kable_styling(bootstrap_options = "responsive", font_size = 13) %>%
scroll_box(width = "100%", height = "500px")
ExProd$BestSellersRank <- NULL
# Is the volume related to the categories?
ExProd %>%
group_by(ProductType) %>%
summarise(Total_Volume = sum(Volume)) %>%
arrange(desc(Total_Volume)) -> Volume_category
# Number of products by category
ExProd %>%
group_by(ProductType) %>%
summarise(Number_Products = n()) %>%
arrange(desc(Number_Products)) -> NumProd_category
# Profit per category
ExProd %>%
group_by(ProductType) %>%
summarise(Mean_Profit_Perc = round(mean(ProfitMargin),2)) %>%
arrange(desc(Mean_Profit_Perc)) -> Profit_category
# # Show the information into one table
# kable(Profit_category %>%
#         left_join(NumProd_category, by = 'ProductType') %>%
#         left_join(Volume_category, by = 'ProductType') %>%
#         mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
#         arrange(desc(Total_Profits)) %>%
#         mutate(Total_Profits = paste0(Total_Profits, " €")),
#       col.names = c("", "Profit", "Nº products",
#                     "Total Volume", "Total Profits")) %>%
#   kable_styling(bootstrap_options = "responsive", font_size = 14) %>%
#   column_spec(1, bold = T, include_thead = T) %>%
#   column_spec(5, background = "#f0f5f0")
# Create a graph to understand
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
coord_flip() +
scale_y_continuous(limits = c(-5000,27000), labels = NULL) +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = round((Total_Profits), 0)),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
labs(title = "Total Profits vs Total Volume") +
theme(legend.position = "bottom",
legend.title = element_blank(),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) + theme_minimal() -> p1
p1 + theme(axis.title.x = element_blank(),
axis.title.y = element_blank())
# Create a graph to understand
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
coord_flip() +
scale_y_continuous(limits = c(-5000,27000), labels = NULL) +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = round((Total_Profits), 0)),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
labs(title = "Total Profits (euros) vs Total Volume (items)") +
theme(legend.position = "bottom",
legend.title = element_blank(),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) + theme_minimal() -> p1
p1 + theme(axis.title.x = element_blank(),
axis.title.y = element_blank())
# Create a graph to understand
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
coord_flip() +
scale_y_continuous(limits = c(-5000,27000), labels = NULL) +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = as.factor(paste0(round((Total_Profits), 0)),"€")),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
labs(title = "Total Profits (euros) vs Total Volume (items)") +
theme(legend.position = "bottom",
legend.title = element_blank(),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) + theme_minimal() -> p1
p1 + theme(axis.title.x = element_blank(),
axis.title.y = element_blank())
p1
# Create a graph to understand
Profit_category %>%
left_join(NumProd_category, by = 'ProductType') %>%
left_join(Volume_category, by = 'ProductType') %>%
mutate(Total_Profits = Mean_Profit_Perc*Total_Volume) %>%
arrange(Total_Profits) %>%
ggplot(aes(x = reorder(ProductType, Total_Profits))) +
geom_col(aes(y = -Total_Profits), fill = "dodgerblue3") +
geom_col(aes(y = Total_Volume), fill = "gold") +
coord_flip() +
scale_y_continuous(limits = c(-5000,27000), labels = NULL) +
geom_label(aes(x = ProductType, y = -Total_Profits,
label = c(round((Total_Profits), 0), "$")),
hjust = 1,
vjust = 0.5,
colour = "dodgerblue3",
fill = NA,
label.size = NA,
size = 3) +
geom_label(aes(x = ProductType, y = Total_Volume,
label = round(Total_Volume, 0)),
hjust = 0,
vjust = 0.5,
colour = "goldenrod3",
fill = NA,
label.size = NA,
size = 3) +
labs(title = "Total Profits (euros) vs Total Volume (items)") +
theme(legend.position = "bottom",
legend.title = element_blank(),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) + theme_minimal() -> p1
p1 + theme(axis.title.x = element_blank(),
axis.title.y = element_blank())
